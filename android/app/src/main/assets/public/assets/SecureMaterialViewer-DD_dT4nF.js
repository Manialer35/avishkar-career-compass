import{aF as j,aH as f,d as w,u as b,r as n,j as e,h as u,m as x,aE as N,b as d,A as g,w as v,s as y}from"./index-BXWU0Hg5.js";import{u as D}from"./useMaterialAccess-BGmPhy14.js";const E=()=>{const{materialId:o}=j(),t=f(),{user:h}=w(),{toast:r}=b(),{hasAccess:i,loading:l,material:s}=D(o||""),[A,S]=n.useState(null),[c,m]=n.useState(!1);n.useEffect(()=>{!l&&!i&&(r({title:"Access Denied",description:"You don't have access to this premium material.",variant:"destructive"}),t("/premium-materials"))},[i,l,t,r]);const p=async()=>{if(!(!(s!=null&&s.downloadurl)||!h))try{m(!0),await y.rpc("increment_material_downloads",{material_id:o});const a=document.createElement("a");a.href=s.downloadurl,a.setAttribute("download",`${s.title}.pdf`),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),r({title:"Download Started",description:"Your secure download has begun."})}catch(a){console.error("Download error:",a),r({title:"Download Failed",description:"Failed to start download. Please try again.",variant:"destructive"})}finally{m(!1)}};return l?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):!i||!s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(u,{className:"max-w-md mx-auto",children:e.jsxs(x,{className:"pt-6 text-center",children:[e.jsx(N,{className:"h-12 w-12 text-destructive mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"You don't have access to this premium material."}),e.jsx(d,{onClick:()=>t("/premium-materials"),children:"Browse Materials"})]})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"mr-4",onClick:()=>t("/premium-materials"),children:e.jsx(g,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-bold text-primary",children:"Secure Material Access"})]}),e.jsx(u,{children:e.jsxs(x,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Secure Access Verified"})]}),e.jsx("h2",{className:"text-xl font-bold mb-4",children:s.title}),s.description&&e.jsx("p",{className:"text-muted-foreground mb-6",children:s.description}),s.thumbnailurl&&e.jsx("div",{className:"mb-6",children:e.jsx("img",{src:s.thumbnailurl,alt:s.title,className:"w-full max-w-md mx-auto rounded-lg shadow-md"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{onClick:p,disabled:!s.downloadurl||c,className:"w-full",children:c?"Preparing Download...":"Download Material"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Security Notice:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• This material is protected by digital rights management"}),e.jsx("li",{children:"• Unauthorized sharing or distribution is prohibited"}),e.jsx("li",{children:"• Your access is logged for security purposes"}),e.jsx("li",{children:"• Downloads are limited to verified purchasers only"})]})]})]})]})})]})};export{E as default};
