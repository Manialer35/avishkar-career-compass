import{c as te,u as ce,r as j,x as de,s as B,j as e,b as y,A as I,a as C,S as Y,L as ne,y as oe,D as me,e as xe,f as ge,g as he,F as ue,B as pe,C as fe,M as je,z as Ne}from"./index-Cu2NTO9G.js";import{T as be,a as ye,b as E,c as D}from"./tabs-BrghG_ne.js";import{u as ve,F as v}from"./useFolders-gOyR_fvA.js";import{F as L,C as we}from"./FolderCard-DxNZeh4c.js";import{B as Ce}from"./badge-DJj60xY-.js";import{Y as T}from"./youtube-JdxukQrN.js";import{V as _e}from"./video-CVF8MeO4.js";import{B as Fe}from"./building-C5SW9RgV.js";import{U as Me}from"./users-l7SdCE1-.js";import{G as Te}from"./graduation-cap-CxAxTjF3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=te("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),J=d=>{const i=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/shorts\/([^&\n?#]+)/];for(const z of i){const w=d.match(z);if(w)return w[1]}return null},ze=d=>`https://img.youtube.com/vi/${d}/maxresdefault.jpg`,Pe=d=>`https://www.youtube.com/embed/${d}`,K=d=>d.includes("youtube.com")||d.includes("youtu.be"),Ue=d=>{const i=d.toLowerCase();return i.includes("math")||i.includes("गणित")?we:i.includes("current affairs")||i.includes("समसामयिक")?ue:i.includes("exam")||i.includes("परीक्षा")?pe:i.includes("age")||i.includes("वय")?fe:i.includes("geography")||i.includes("भूगोल")?je:i.includes("history")||i.includes("इतिहास")?Fe:i.includes("group")||i.includes("समूह")?Me:i.includes("education")||i.includes("शिक्षण")?Te:Ne},We=()=>{const{toast:d}=ce(),[i,z]=j.useState([]),[w,Q]=j.useState([]),[N,X]=j.useState([]),[b,Z]=j.useState([]),[c,A]=j.useState(!0),[W,P]=j.useState(null),[G,U]=de(),n=G.get("folderId"),_=G.get("tab")||"free",{folders:O}=ve(),F=O.filter(s=>!s.is_premium),M=O.filter(s=>s.is_premium);b.filter(s=>!s.is_premium),b.filter(s=>s.is_premium);const q=n?i.filter(s=>s.folder_id===n):i.filter(s=>!s.folder_id),H=n?w.filter(s=>s.folder_id===n):w.filter(s=>!s.folder_id),k=n?N.filter(s=>s.folder_id===n):N.filter(s=>!s.folder_id),g=q.filter(s=>!s.isUpcoming),h=q.filter(s=>s.isUpcoming),u=H.filter(s=>!s.isUpcoming),p=H.filter(s=>s.isUpcoming);j.useEffect(()=>{ee(),se()},[]),j.useEffect(()=>{N.length>=0&&le()},[N]);const ee=async()=>{try{console.log("Fetching study materials..."),A(!0);const{data:s,error:l}=await B.from("study_materials").select("*").order("created_at",{ascending:!1});if(console.log("Study materials fetch result:",{data:s,error:l}),l)throw l;if(s){console.log(`Found ${s.length} study materials, processing...`);const a=s.map(t=>({id:t.id,title:t.title,description:t.description||"",downloadUrl:t.downloadurl||"",thumbnailUrl:t.thumbnailurl||void 0,isPremium:t.ispremium||!1,price:t.price,folder_id:t.folder_id,isUpcoming:t.is_upcoming})),r=a.filter(t=>!t.isPremium),o=a.filter(t=>t.isPremium);console.log(`Processed: ${r.length} free materials, ${o.length} paid materials`),z(r),Q(o)}}catch(s){console.error("Error fetching materials:",s),d({title:"Error",description:"Failed to load study materials. Please try again.",variant:"destructive"})}finally{A(!1)}},se=async()=>{try{const{data:s,error:l}=await B.from("training_videos").select("*").order("created_at",{ascending:!1});if(l)throw l;s&&X(s)}catch(s){console.error("Error fetching training videos:",s)}},le=async()=>{try{const{data:s,error:l}=await B.from("training_video_folders").select("*").order("name");if(l)throw l;if(s){const a=s.map(r=>({...r,videoCount:N.filter(o=>o.folder_id===r.id).length}));Z(a)}}catch(s){console.error("Error fetching video folders:",s)}},S=(s,l)=>{U({folderId:s,tab:l})},V=()=>{U({tab:_})},ie=s=>{U({tab:s})},m=(_==="videos"?b:_==="premium"?M:F).find(s=>s.id===n),x=()=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[1,2,3,4,5,6].map((s,l)=>e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-sm border",children:[e.jsx(Y,{className:"w-12 h-12 mx-auto mb-3 rounded-lg"}),e.jsx(Y,{className:"w-full h-4 mb-2"}),e.jsx(Y,{className:"w-3/4 h-3 mx-auto"})]},l))}),f=({material:s,isPremium:l=!1})=>{const a=Ue(s.title);return e.jsxs("div",{className:`bg-white rounded-lg p-4 shadow-sm border transition-all hover:shadow-md cursor-pointer relative ${l?"border-l-4 border-l-academy-red":"border-l-4 border-l-academy-primary"}`,children:[s.isUpcoming&&e.jsx("div",{className:"absolute top-2 right-2 z-10",children:e.jsxs(Ce,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 border-yellow-300 text-xs px-2 py-1",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Coming Soon"]})}),e.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[e.jsx("div",{className:`p-3 rounded-lg ${l?"bg-academy-red/10":"bg-academy-primary/10"} ${s.isUpcoming?"opacity-60":""}`,children:e.jsx(a,{size:32,className:`${l?"text-academy-red":"text-academy-primary"} ${s.isUpcoming?"opacity-60":""}`})}),e.jsx("h3",{className:`font-semibold text-sm line-clamp-2 min-h-[2.5rem] ${s.isUpcoming?"text-gray-500":""}`,children:s.title}),s.description&&e.jsx("p",{className:`text-xs text-gray-600 line-clamp-2 ${s.isUpcoming?"opacity-60":""}`,children:s.description}),l&&s.price&&!s.isUpcoming&&e.jsxs("div",{className:"text-sm font-semibold text-academy-red",children:["₹",s.price]}),e.jsx("div",{className:"w-full pt-2",children:s.isUpcoming?e.jsx(y,{variant:"outline",size:"sm",className:"w-full text-xs cursor-not-allowed bg-gray-100 text-gray-500 border-gray-300",disabled:!0,children:"Not Available Yet"}):l?e.jsx(y,{size:"sm",className:"w-full bg-academy-red hover:bg-academy-red/90 text-white text-xs",asChild:!0,children:e.jsx(ne,{to:`/premium-materials?materialId=${s.id}`,children:"Purchase Now"})}):e.jsx(y,{variant:"ghost",size:"sm",className:"w-full text-academy-primary hover:text-academy-red hover:bg-gray-100 text-xs",asChild:!0,children:e.jsxs("a",{href:s.downloadUrl,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),"Download"]})})})]})]})},$=({video:s})=>{const l=K(s.video_url),a=l?J(s.video_url):null,r=a?ze(a):s.thumbnail_url;return e.jsx("div",{className:`bg-white rounded-lg p-4 shadow-sm border transition-all hover:shadow-md cursor-pointer ${s.is_premium?"border-l-4 border-l-academy-red":"border-l-4 border-l-academy-primary"}`,onClick:()=>P(s),children:e.jsxs("div",{className:"flex flex-col space-y-3",children:[e.jsxs("div",{className:"relative w-full aspect-video rounded-lg overflow-hidden bg-gray-100",children:[r?e.jsx("img",{src:r,alt:s.title,className:"w-full h-full object-cover",onError:o=>{const t=o.target;a&&(t.src=`https://img.youtube.com/vi/${a}/hqdefault.jpg`)}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-200",children:l?e.jsx(T,{size:32,className:"text-red-500"}):e.jsx(_e,{size:32,className:"text-gray-400"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:`p-2 rounded-full bg-black bg-opacity-50 ${s.is_premium?"text-academy-red":"text-white"}`,children:l?e.jsx(T,{size:20,className:"text-red-500",fill:"currentColor"}):e.jsx(R,{size:20,fill:"currentColor"})})}),l&&e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("div",{className:"bg-red-600 text-white text-xs px-2 py-1 rounded",children:"YouTube"})})]}),e.jsxs("div",{className:"flex flex-col space-y-2 text-center min-h-[5rem]",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 leading-tight",title:s.title,children:s.title}),s.description&&e.jsx("p",{className:"text-xs text-gray-600 line-clamp-2 leading-tight",title:s.description,children:s.description})]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("div",{className:"text-xs text-gray-500 capitalize text-center",children:s.category}),s.is_premium&&e.jsx("div",{className:"text-sm font-semibold text-academy-red text-center",children:"Premium"}),e.jsxs(y,{variant:"ghost",size:"sm",className:`w-full text-xs ${s.is_premium?"text-academy-red hover:text-academy-red hover:bg-red-50":"text-academy-primary hover:text-academy-red hover:bg-gray-100"}`,onClick:o=>{o.stopPropagation(),P(s)},children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Watch Video"]})]})]})})},ae=({video:s,onClose:l})=>{const a=K(s.video_url),r=a?J(s.video_url):null,o=r?Pe(r):s.video_url;return e.jsx(me,{open:!!s,onOpenChange:l,children:e.jsxs(xe,{className:"max-w-4xl w-full",children:[e.jsx(ge,{children:e.jsxs(he,{className:"flex items-center gap-2",children:[s.title,a&&e.jsx(T,{size:20,className:"text-red-500"})]})}),e.jsx("div",{className:"aspect-video w-full",children:a?e.jsx("iframe",{src:o,title:s.title,className:"w-full h-full rounded-lg",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):e.jsx("video",{src:s.video_url,controls:!0,className:"w-full h-full rounded-lg",poster:s.thumbnail_url,children:"Your browser does not support the video tag."})}),s.description&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600 text-sm",children:s.description})]})]})})},re=()=>{const s=k.filter(l=>!l.folder_id);return e.jsxs("div",{className:"space-y-8",children:[s.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-4 text-gray-700",children:"Unorganized Videos"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:s.map(l=>e.jsx($,{video:l},l.id))})]}),b.map(l=>{const a=N.filter(r=>r.folder_id===l.id);return a.length===0?null:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(v,{size:20,className:"text-academy-primary"}),e.jsx("h3",{className:"text-lg font-medium text-academy-primary",children:l.name}),l.is_premium&&e.jsx("span",{className:"text-xs bg-academy-red text-white px-2 py-1 rounded-full",children:"Premium"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.length," videos)"]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(r=>e.jsx($,{video:r},r.id))})]},l.id)})]})};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-academy-primary mb-6",children:"Study Materials"}),e.jsxs(be,{value:_,onValueChange:ie,className:"w-full",children:[e.jsxs(ye,{className:"w-full mb-4",children:[e.jsx(E,{value:"free",className:"flex-1",children:"Free Materials"}),e.jsx(E,{value:"premium",className:"flex-1",children:"Premium Materials"}),e.jsx(E,{value:"videos",className:"flex-1",children:"Training Videos"})]}),e.jsx(D,{value:"free",className:"mt-4",children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(y,{variant:"ghost",onClick:V,className:"flex items-center gap-2",children:[e.jsx(I,{size:16}),"Back to Folders"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:20,className:"text-academy-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:m==null?void 0:m.name})]})]}),e.jsxs("div",{className:"space-y-8",children:[g.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Available Materials (",g.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.map(s=>e.jsx(f,{material:s},s.id))})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"text-yellow-600"}),"Coming Soon (",h.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:h.map(s=>e.jsx(f,{material:s},s.id))})]}),!c&&g.length===0&&h.length===0&&e.jsx("div",{className:"text-center py-8",children:"No materials found in this folder."})]})]}):e.jsxs("div",{className:"space-y-8",children:[F.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"text-academy-primary"}),"Material Folders"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:F.map(s=>e.jsx(L,{folder:s,onClick:()=>S(s.id,"free")},s.id))})]}),g.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Available Materials (",g.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:g.map(s=>e.jsx(f,{material:s},s.id))})]}),h.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"text-yellow-600"}),"Coming Soon (",h.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:h.map(s=>e.jsx(f,{material:s},s.id))})]}),!c&&g.length===0&&h.length===0&&F.length===0&&e.jsx("div",{className:"text-center py-8",children:"No free materials found."})]})}),e.jsx(D,{value:"premium",className:"mt-4",children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(y,{variant:"ghost",onClick:V,className:"flex items-center gap-2",children:[e.jsx(I,{size:16}),"Back to Folders"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:20,className:"text-academy-red"}),e.jsx("h2",{className:"text-xl font-semibold",children:m==null?void 0:m.name})]})]}),e.jsxs("div",{className:"space-y-8",children:[u.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Available Materials (",u.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(s=>e.jsx(f,{material:s,isPremium:!0},s.id))})]}),p.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"text-yellow-600"}),"Coming Soon (",p.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(s=>e.jsx(f,{material:s,isPremium:!0},s.id))})]}),!c&&u.length===0&&p.length===0&&e.jsx("div",{className:"text-center py-8",children:"No materials found in this folder."})]})]}):e.jsxs("div",{className:"space-y-8",children:[M.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"text-academy-red"}),"Premium Folders"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:M.map(s=>e.jsx(L,{folder:s,onClick:()=>S(s.id,"premium")},s.id))})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Available Premium Materials (",u.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map(s=>e.jsx(f,{material:s,isPremium:!0},s.id))})]}),p.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(C,{className:"text-yellow-600"}),"Coming Soon (",p.length,")"]}),c?x():e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:p.map(s=>e.jsx(f,{material:s,isPremium:!0},s.id))})]}),!c&&u.length===0&&p.length===0&&M.length===0&&e.jsx("div",{className:"text-center py-8",children:"No premium materials found."})]})}),e.jsx(D,{value:"videos",className:"mt-4",children:n?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(y,{variant:"ghost",onClick:V,className:"flex items-center gap-2",children:[e.jsx(I,{size:16}),"Back to Folders"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:20,className:"text-academy-primary"}),e.jsx("h2",{className:"text-xl font-semibold",children:m==null?void 0:m.name})]})]}),k.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:k.map(s=>e.jsx($,{video:s},s.id))}):e.jsx("div",{className:"text-center py-8",children:"No videos found in this folder."})]}):e.jsxs("div",{className:"space-y-8",children:[b.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[e.jsx(v,{className:"text-academy-primary"}),"Video Folders"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8",children:b.map(s=>e.jsx(L,{folder:{...s,materialCount:s.videoCount},onClick:()=>S(s.id,"videos")},s.id))})]}),c?x():e.jsx(re,{}),!c&&N.length===0&&b.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{size:64,className:"text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Training Videos Yet"}),e.jsx("p",{className:"text-gray-600",children:"Training videos will be available here soon."})]})]})})]}),W&&e.jsx(ae,{video:W,onClose:()=>P(null)})]})};export{We as default};
