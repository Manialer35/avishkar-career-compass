import{c as Ne,r,u as ve,s as C,j as e,h as y,m as b,S as f,U as k,w as ye,b as w,n as be,C as De,aq as q,ah as Ae,ai as we,E as B,ar as Ce,o as _e,aj as Te,I as Se,as as Re,af as Ee,at as J,ak as Ue,au as Oe,ag as Pe,t as N,ao as G,av as T,d as Le,ap as ke,N as Ie,i as Me,k as $e,D as Fe,e as ze,f as He,g as qe}from"./index-Cu2NTO9G.js";import{I}from"./input-Bhqui301.js";import{B as D}from"./badge-DJj60xY-.js";import{T as Be,a as Je,b as O,c as P}from"./tabs-BrghG_ne.js";import{a as M,b as $,c as S,d as u,e as F,f as j,T as V,R as z,S as Ge}from"./table-Bb8W3RLy.js";import{L as H}from"./label-BqNnaO06.js";import{A as Ve}from"./AdminNavigation-XzdsiYvW.js";import"./settings-n1Qor9pj.js";import"./users-l7SdCE1-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=Ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Ye=(s="")=>{const[a,t]=r.useState([]),[l,i]=r.useState(!1),[p,m]=r.useState(!1),[d,o]=r.useState(null),{toast:c}=ve(),x=async()=>{i(!0);try{const{data:n,error:v}=await C.rpc("get_users_with_roles");if(v)throw v;const _=(n||[]).map(h=>({id:h.id,email:h.phone_number||"No phone available",role:h.role||"user",full_name:h.full_name,created_at:h.created_at}));t(_)}catch(n){console.error("Error fetching users:",n),c({title:"Error fetching users",description:n.message,variant:"destructive"})}finally{i(!1)}};r.useEffect(()=>{x();const n=C.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},()=>{x()}).on("postgres_changes",{event:"*",schema:"public",table:"user_roles"},()=>{x()}).subscribe();return()=>{C.removeChannel(n)}},[]);const R=async()=>{if(d)try{const{error:n}=await C.from("profiles").delete().eq("id",d.id);if(n)throw n;t(a.filter(v=>v.id!==d.id)),c({title:"User deleted",description:`${d.full_name||"User"} has been deleted successfully.`})}catch(n){c({title:"Error",description:n.message,variant:"destructive"})}finally{m(!1),o(null)}},E=n=>{o(n),m(!0)};return{users:a.filter(n=>n.email.toLowerCase().includes(s.toLowerCase())||n.full_name&&n.full_name.toLowerCase().includes(s.toLowerCase())),loading:l,isDeleteDialogOpen:p,setIsDeleteDialogOpen:m,userToDelete:d,setUserToDelete:o,confirmDeleteUser:E,handleDeleteUser:R,refreshUsers:x}},Ke=()=>e.jsxs(S,{children:[e.jsx(j,{children:e.jsx(f,{className:"h-4 w-[120px]"})}),e.jsx(j,{className:"hidden sm:table-cell",children:e.jsx(f,{className:"h-4 w-[180px]"})}),e.jsx(j,{children:e.jsx(f,{className:"h-6 w-[60px]"})}),e.jsx(j,{className:"hidden lg:table-cell",children:e.jsx(f,{className:"h-4 w-[80px]"})}),e.jsx(j,{children:e.jsx(f,{className:"h-8 w-8"})})]}),Qe=({user:s,onDeleteUser:a})=>e.jsx(y,{className:"mb-3",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:s.full_name||"N/A"}),e.jsx(D,{variant:s.role==="admin"?"default":"outline",className:"text-xs",children:s.role})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(be,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate",children:s.email})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[e.jsx(De,{className:"h-3 w-3"}),e.jsxs("span",{children:["Joined ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsx(w,{variant:"outline",size:"icon",className:"text-red-500 hover:text-red-700 ml-3",onClick:()=>a(s),children:e.jsx(V,{className:"h-4 w-4"})})]})})}),L=({users:s,loading:a,onDeleteUser:t})=>a?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{className:"hidden sm:table-cell",children:"Email"}),e.jsx(u,{children:"Role"}),e.jsx(u,{className:"hidden lg:table-cell",children:"Joined"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(F,{children:Array(3).fill(0).map((l,i)=>e.jsx(Ke,{},i))})]})}),e.jsx("div",{className:"sm:hidden space-y-3",children:Array(3).fill(0).map((l,i)=>e.jsx(y,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{className:"h-4 w-[140px]"}),e.jsx(f,{className:"h-3 w-[200px]"}),e.jsx(f,{className:"h-3 w-[100px]"})]})})},i))})]}):s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search criteria."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"hidden sm:block",children:e.jsxs(M,{children:[e.jsx($,{children:e.jsxs(S,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{className:"hidden sm:table-cell",children:"Email"}),e.jsx(u,{children:"Role"}),e.jsx(u,{className:"hidden lg:table-cell",children:"Joined"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(F,{children:s.map(l=>e.jsxs(S,{className:"hover:bg-muted/50",children:[e.jsx(j,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:l.full_name||"N/A"})]})}),e.jsx(j,{className:"hidden sm:table-cell",children:e.jsx("div",{className:"max-w-[200px] truncate",children:l.email})}),e.jsx(j,{children:e.jsxs(D,{variant:l.role==="admin"?"default":"outline",children:[l.role==="admin"&&e.jsx(ye,{className:"h-3 w-3 mr-1"}),l.role]})}),e.jsx(j,{className:"hidden lg:table-cell text-gray-600",children:new Date(l.created_at).toLocaleDateString()}),e.jsx(j,{className:"text-right",children:e.jsx(w,{variant:"outline",size:"icon",className:"text-red-500 hover:text-red-700",onClick:()=>t(l),children:e.jsx(V,{className:"h-4 w-4"})})})]},l.id))})]})}),e.jsx("div",{className:"sm:hidden",children:s.map(l=>e.jsx(Qe,{user:l,onDeleteUser:t},l.id))})]}),Xe=({users:s,loading:a,onDeleteUser:t})=>e.jsxs(Be,{defaultValue:"all",children:[e.jsxs(Je,{className:"mb-4",children:[e.jsx(O,{value:"all",children:"All Users"}),e.jsx(O,{value:"admin",children:"Admins"}),e.jsx(O,{value:"user",children:"Students"})]}),e.jsx(P,{value:"all",children:e.jsx(L,{users:s,loading:a,onDeleteUser:t})}),e.jsx(P,{value:"admin",children:e.jsx(L,{users:s.filter(l=>l.role==="admin"),loading:a,onDeleteUser:t})}),e.jsx(P,{value:"user",children:e.jsx(L,{users:s.filter(l=>l.role==="user"),loading:a,onDeleteUser:t})})]});var W="AlertDialog",[Ze,ws]=_e(W,[q]),g=q(),Y=s=>{const{__scopeAlertDialog:a,...t}=s,l=g(a);return e.jsx(Ae,{...l,...t,modal:!0})};Y.displayName=W;var es="AlertDialogTrigger",ss=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=g(t);return e.jsx(Oe,{...i,...l,ref:a})});ss.displayName=es;var as="AlertDialogPortal",K=s=>{const{__scopeAlertDialog:a,...t}=s,l=g(a);return e.jsx(we,{...l,...t})};K.displayName=as;var ts="AlertDialogOverlay",Q=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=g(t);return e.jsx(Ue,{...i,...l,ref:a})});Q.displayName=ts;var A="AlertDialogContent",[ls,rs]=Ze(A),is=Re("AlertDialogContent"),X=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,children:l,...i}=s,p=g(t),m=r.useRef(null),d=B(a,m),o=r.useRef(null);return e.jsx(Ce,{contentName:A,titleName:Z,docsSlug:"alert-dialog",children:e.jsx(ls,{scope:t,cancelRef:o,children:e.jsxs(Te,{role:"alertdialog",...p,...i,ref:d,onOpenAutoFocus:Se(i.onOpenAutoFocus,c=>{var x;c.preventDefault(),(x=o.current)==null||x.focus({preventScroll:!0})}),onPointerDownOutside:c=>c.preventDefault(),onInteractOutside:c=>c.preventDefault(),children:[e.jsx(is,{children:l}),e.jsx(os,{contentRef:m})]})})})});X.displayName=A;var Z="AlertDialogTitle",ee=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=g(t);return e.jsx(Ee,{...i,...l,ref:a})});ee.displayName=Z;var se="AlertDialogDescription",ae=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=g(t);return e.jsx(Pe,{...i,...l,ref:a})});ae.displayName=se;var ns="AlertDialogAction",te=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,i=g(t);return e.jsx(J,{...i,...l,ref:a})});te.displayName=ns;var le="AlertDialogCancel",re=r.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...l}=s,{cancelRef:i}=rs(le,t),p=g(t),m=B(a,i);return e.jsx(J,{...p,...l,ref:m})});re.displayName=le;var os=({contentRef:s})=>{const a=`\`${A}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${A}\` by passing a \`${se}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${A}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return r.useEffect(()=>{var l;document.getElementById((l=s.current)==null?void 0:l.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},cs=Y,ds=K,ie=Q,ne=X,oe=te,ce=re,de=ee,me=ae;const ms=cs,xs=ds,xe=r.forwardRef(({className:s,...a},t)=>e.jsx(ie,{className:N("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));xe.displayName=ie.displayName;const he=r.forwardRef(({className:s,...a},t)=>e.jsxs(xs,{children:[e.jsx(xe,{}),e.jsx(ne,{ref:t,className:N("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));he.displayName=ne.displayName;const pe=({className:s,...a})=>e.jsx("div",{className:N("flex flex-col space-y-2 text-center sm:text-left",s),...a});pe.displayName="AlertDialogHeader";const ue=({className:s,...a})=>e.jsx("div",{className:N("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});ue.displayName="AlertDialogFooter";const je=r.forwardRef(({className:s,...a},t)=>e.jsx(de,{ref:t,className:N("text-lg font-semibold",s),...a}));je.displayName=de.displayName;const hs=r.forwardRef(({className:s,...a},t)=>e.jsx(me,{ref:t,className:N("text-sm text-muted-foreground",s),...a}));hs.displayName=me.displayName;const ge=r.forwardRef(({className:s,...a},t)=>e.jsx(oe,{ref:t,className:N(G(),s),...a}));ge.displayName=oe.displayName;const fe=r.forwardRef(({className:s,...a},t)=>e.jsx(ce,{ref:t,className:N(G({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));fe.displayName=ce.displayName;const ps=({isOpen:s,onOpenChange:a,onDelete:t})=>e.jsx(ms,{open:s,onOpenChange:a,children:e.jsxs(he,{children:[e.jsx(pe,{children:e.jsx(je,{children:"Are you sure you want to delete this user?"})}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone. This will permanently delete the user account and remove their data from our servers."}),e.jsxs(ue,{children:[e.jsx(fe,{children:"Cancel"}),e.jsx(ge,{onClick:t,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),us=({onComplete:s})=>{const[a,t]=r.useState(""),[l,i]=r.useState(""),[p,m]=r.useState(!1),d=async o=>{if(o.preventDefault(),!a||!l){T({title:"Missing fields",description:"Please fill in all fields",variant:"destructive"});return}if(!a.startsWith("+")){T({title:"Invalid phone number",description:"Phone number must include country code (e.g., +918888769281)",variant:"destructive"});return}m(!0);try{const{data:c,error:x}=await C.rpc("promote_phone_to_admin",{target_phone:a});if(x)throw x;T({title:"Admin Created",description:c||"Admin privileges have been granted successfully"}),s()}catch(c){T({title:"Error",description:c.message,variant:"destructive"})}finally{m(!1)}};return e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(I,{id:"phoneNumber",type:"tel",placeholder:"+918888769281",value:a,onChange:o=>t(o.target.value),required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Include country code (e.g., +91 for India)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{htmlFor:"fullName",children:"Full Name"}),e.jsx(I,{id:"fullName",type:"text",placeholder:"John Doe",value:l,onChange:o=>i(o.target.value),required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(w,{type:"button",variant:"outline",onClick:s,children:"Cancel"}),e.jsx(w,{type:"submit",disabled:p,children:p?"Creating...":"Create Admin"})]})]})},Cs=()=>{const[s,a]=r.useState(""),[t,l]=r.useState(!1),{user:i}=Le(),{isAdmin:p,loading:m}=ke(),{users:d,loading:o,isDeleteDialogOpen:c,setIsDeleteDialogOpen:x,confirmDeleteUser:R,handleDeleteUser:E,refreshUsers:U}=Ye(s);if(m)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})});if(!i||!p)return e.jsx(Ie,{to:"/auth",replace:!0});const n=d.filter(h=>h.role==="admin"),v=d.filter(h=>h.role==="user"),_=d.length;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Ve,{}),e.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage users, roles, and access permissions"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>l(!0),className:"order-2 sm:order-1",children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Create Admin"]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:U,disabled:o,className:"order-1 sm:order-2",children:[e.jsx(z,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(y,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold",children:_})]}),e.jsx(D,{variant:"secondary",children:_})]})})}),e.jsx(y,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Administrators"}),e.jsx("p",{className:"text-2xl font-bold",children:n.length})]}),e.jsx(D,{variant:"default",children:n.length})]})})}),e.jsx(y,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Regular Users"}),e.jsx("p",{className:"text-2xl font-bold",children:v.length})]}),e.jsx(D,{variant:"outline",children:v.length})]})})})]}),e.jsx(y,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 h-4 w-4 text-gray-400 transform -translate-y-1/2"}),e.jsx(I,{placeholder:"Search users by name or email...",className:"pl-10",value:s,onChange:h=>a(h.target.value)})]})})}),e.jsxs(y,{children:[e.jsx(Me,{children:e.jsxs($e,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Users"}),o&&e.jsxs(D,{variant:"secondary",children:[e.jsx(z,{className:"h-3 w-3 mr-1 animate-spin"}),"Loading..."]})]})}),e.jsx(b,{className:"p-0",children:e.jsx(Xe,{users:d,loading:o,onDeleteUser:R})})]}),e.jsx(Fe,{open:t,onOpenChange:l,children:e.jsxs(ze,{className:"sm:max-w-md",children:[e.jsx(He,{children:e.jsx(qe,{children:"Create Admin User"})}),e.jsx(us,{onComplete:()=>{l(!1),U()}})]})}),e.jsx(ps,{isOpen:c,onOpenChange:x,onDelete:E})]})]})};export{Cs as default};
