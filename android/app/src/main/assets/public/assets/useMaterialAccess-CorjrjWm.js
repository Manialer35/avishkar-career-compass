import{r as a,d as A,u as E,s as p}from"./index-G_H0xwe1.js";const y=s=>{const[d,e]=a.useState(!1),[h,r]=a.useState(!0),[m,w]=a.useState(null),{user:c}=A(),{toast:l}=E();a.useEffect(()=>{s&&c?u():r(!1)},[s,c]);const u=async()=>{try{r(!0);const{data:t,error:n}=await p.from("study_materials").select("*").eq("id",s).single();if(n)throw n;if(w(t),!t.ispremium){e(!0);return}const{data:i,error:o}=await p.from("user_purchases").select("*").eq("user_id",c.uid).eq("material_id",s).maybeSingle();if(o&&o.code!=="PGRST116")throw o;if(i){const x=new Date,f=i.expires_at?new Date(i.expires_at):null;!f||f>x?e(!0):(e(!1),l({title:"Access Expired",description:"Your access to this material has expired. Please purchase again.",variant:"destructive"}))}else e(!1)}catch(t){console.error("Error checking material access:",t),e(!1),l({title:"Error",description:"Failed to verify access to this material.",variant:"destructive"})}finally{r(!1)}};return{hasAccess:d,loading:h,material:m,checkAccess:u}};export{y as u};
