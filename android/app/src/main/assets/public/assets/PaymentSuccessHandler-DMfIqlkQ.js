import{x as p,aC as y,d as h,u as f,r as x,j as a,h as g,m as v,s as u}from"./index-Cu2NTO9G.js";import{L as P}from"./loader-circle-DUvSaSjb.js";const b=()=>{const[r]=p(),s=y(),{user:e}=h(),{toast:i}=f();return x.useEffect(()=>{(async()=>{const c=r.get("payment_id"),o=r.get("order_id"),m=r.get("signature"),n=r.get("material_id");if(!c||!o||!m||!n||!e){i({title:"Payment Error",description:"Invalid payment parameters",variant:"destructive"}),s("/premium-materials");return}try{const{data:t,error:d}=await u.functions.invoke("verify-razorpay-payment",{body:{razorpay_payment_id:c,razorpay_order_id:o,razorpay_signature:m,productId:n}});if(d)throw d;if(t.success){const{error:l}=await u.from("user_purchases").insert({user_id:(e==null?void 0:e.id)||(e==null?void 0:e.uid)||"",material_id:n,payment_id:c,amount:t.amount||0,purchased_at:new Date().toISOString()});l&&console.error("Error recording purchase:",l),i({title:"Payment Successful!",description:"Your study material has been unlocked"}),s(`/material/${n}/access`,{state:{purchaseSuccess:!0}})}else throw new Error("Payment verification failed")}catch(t){console.error("Payment verification error:",t),i({title:"Payment Verification Failed",description:t.message||"Please contact support",variant:"destructive"}),s("/premium-materials")}})()},[r,e,s,i]),a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:a.jsx(g,{className:"w-full max-w-md",children:a.jsxs(v,{className:"p-8 text-center",children:[a.jsx("div",{className:"flex items-center justify-center mb-4",children:a.jsx(P,{className:"h-8 w-8 animate-spin text-blue-600"})}),a.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Processing Payment"}),a.jsx("p",{className:"text-gray-600",children:"Please wait while we verify your payment and unlock your study material..."})]})})})};export{b as default};
