import{c as H,r as m,j as e,o as ee,P as I,p as ae,q as P,t as k,d as T,u as re,s as g,N as se,R as te,v as U,h as _,i as w,k as E,w as M,m as C,n as ne,C as le,U as ie,b as N,X as oe}from"./index-DuRND2GT.js";import{I as L}from"./input-DWyXMKWd.js";import{L as b}from"./label-Zai3joRB.js";import{B as D}from"./badge-BCMy8Vf2.js";import{S as ce}from"./separator-CeR8VDfT.js";import{P as de}from"./phone-DWHMugZN.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=H("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=H("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var V={exports:{}},q={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v=m;function fe(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var he=typeof Object.is=="function"?Object.is:fe,xe=v.useState,pe=v.useEffect,ge=v.useLayoutEffect,ve=v.useDebugValue;function je(s,a){var r=a(),c=xe({inst:{value:r,getSnapshot:a}}),i=c[0].inst,l=c[1];return ge(function(){i.value=r,i.getSnapshot=a,A(i)&&l({inst:i})},[s,r,a]),pe(function(){return A(i)&&l({inst:i}),s(function(){A(i)&&l({inst:i})})},[s]),ve(r),r}function A(s){var a=s.getSnapshot;s=s.value;try{var r=a();return!he(s,r)}catch{return!0}}function ye(s,a){return a()}var Ne=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?ye:je;q.useSyncExternalStore=v.useSyncExternalStore!==void 0?v.useSyncExternalStore:Ne;V.exports=q;var be=V.exports;function Se(){return be.useSyncExternalStore(_e,()=>!0,()=>!1)}function _e(){return()=>{}}var F="Avatar",[we,Me]=ee(F),[Ee,z]=we(F),B=m.forwardRef((s,a)=>{const{__scopeAvatar:r,...c}=s,[i,l]=m.useState("idle");return e.jsx(Ee,{scope:r,imageLoadingStatus:i,onImageLoadingStatusChange:l,children:e.jsx(I.span,{...c,ref:a})})});B.displayName=F;var R="AvatarImage",Y=m.forwardRef((s,a)=>{const{__scopeAvatar:r,src:c,onLoadingStatusChange:i=()=>{},...l}=s,x=z(R,r),o=Ce(c,l),t=ae(d=>{i(d),x.onImageLoadingStatusChange(d)});return P(()=>{o!=="idle"&&t(o)},[o,t]),o==="loaded"?e.jsx(I.img,{...l,ref:a,src:c}):null});Y.displayName=R;var G="AvatarFallback",O=m.forwardRef((s,a)=>{const{__scopeAvatar:r,delayMs:c,...i}=s,l=z(G,r),[x,o]=m.useState(c===void 0);return m.useEffect(()=>{if(c!==void 0){const t=window.setTimeout(()=>o(!0),c);return()=>window.clearTimeout(t)}},[c]),x&&l.imageLoadingStatus!=="loaded"?e.jsx(I.span,{...i,ref:a}):null});O.displayName=G;function $(s,a){return s?a?(s.src!==a&&(s.src=a),s.complete&&s.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Ce(s,{referrerPolicy:a,crossOrigin:r}){const c=Se(),i=m.useRef(null),l=c?(i.current||(i.current=new window.Image),i.current):null,[x,o]=m.useState(()=>$(l,s));return P(()=>{o($(l,s))},[l,s]),P(()=>{const t=p=>()=>{o(p)};if(!l)return;const d=t("loaded"),h=t("error");return l.addEventListener("load",d),l.addEventListener("error",h),a&&(l.referrerPolicy=a),typeof r=="string"&&(l.crossOrigin=r),()=>{l.removeEventListener("load",d),l.removeEventListener("error",h)}},[l,r,a]),x}var J=B,K=Y,W=O;const X=m.forwardRef(({className:s,...a},r)=>e.jsx(J,{ref:r,className:k("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...a}));X.displayName=J.displayName;const Q=m.forwardRef(({className:s,...a},r)=>e.jsx(K,{ref:r,className:k("aspect-square h-full w-full",s),...a}));Q.displayName=K.displayName;const Z=m.forwardRef(({className:s,...a},r)=>e.jsx(W,{ref:r,className:k("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...a}));Z.displayName=W.displayName;const Le=()=>{const[s,a]=m.useState(null),[r,c]=m.useState(null),[i,l]=m.useState(!0),[x,o]=m.useState(!1),{user:t}=T(),{toast:d}=re(),h=async()=>{if(t)try{l(!0),await p();const{data:u,error:n}=await g.from("profiles").select("*").eq("id",t.uid).maybeSingle();n&&console.error("Profile fetch error:",n);const{data:f,error:j}=await g.from("user_roles").select("role, phone_number").eq("user_id",t.uid).maybeSingle();j&&console.error("Role fetch error:",j),a(u),c(f)}catch(u){console.error("Error fetching profile:",u),d({title:"Error loading profile",description:u.message,variant:"destructive"})}finally{l(!1)}},p=async()=>{if(t)try{const{error:u}=await g.from("profiles").upsert({id:t.uid,username:t.email?t.email.split("@")[0]:`user_${t.uid.substring(0,8)}`,full_name:t.displayName||null,avatar_url:t.photoURL||null},{onConflict:"id",ignoreDuplicates:!0});u&&console.error("Profile creation error:",u);const{error:n}=await g.from("user_roles").upsert({user_id:t.uid,role:t.phoneNumber&&["+918888769281","+918484843232"].includes(t.phoneNumber)?"admin":"user",phone_number:t.phoneNumber||null},{onConflict:"user_id",ignoreDuplicates:!0});n&&console.error("Role creation error:",n)}catch(u){console.error("Error ensuring user profile exists:",u)}},y=async u=>{if(!t)return!1;try{o(!0),await p();const{error:n}=await g.from("profiles").upsert({id:t.uid,...u,updated_at:new Date().toISOString()},{onConflict:"id"});if(n)throw n;return a(f=>f?{...f,...u}:null),d({title:"Profile updated",description:"Your profile has been updated successfully."}),!0}catch(n){return console.error("Error updating profile:",n),d({title:"Error updating profile",description:n.message,variant:"destructive"}),!1}finally{o(!1)}},S=async u=>{if(!t)return!1;try{o(!0),await p();const{error:n}=await g.from("user_roles").upsert({user_id:t.uid,phone_number:u,role:(r==null?void 0:r.role)||"user"},{onConflict:"user_id"});if(n)throw n;return c(f=>f?{...f,phone_number:u}:{role:"user",phone_number:u}),d({title:"Phone number updated",description:"Your phone number has been updated successfully."}),!0}catch(n){return console.error("Error updating phone number:",n),d({title:"Error updating phone number",description:n.message,variant:"destructive"}),!1}finally{o(!1)}};return m.useEffect(()=>{h()},[t]),{profile:s,userRole:r,loading:i,updating:x,updateProfile:y,updatePhoneNumber:S,refreshProfile:h}},De=()=>{var u;const{user:s}=T(),{profile:a,userRole:r,loading:c,updating:i,updateProfile:l,updatePhoneNumber:x}=Le(),[o,t]=m.useState(!1),[d,h]=m.useState({full_name:"",username:"",phone_number:""});if(!s)return e.jsx(se,{to:"/auth",replace:!0});te.useEffect(()=>{a&&h({full_name:a.full_name||"",username:a.username||"",phone_number:(r==null?void 0:r.phone_number)||""})},[a,r]);const p=async()=>{try{const n={full_name:d.full_name||null,username:d.username||null},f=await l(n);let j=!0;d.phone_number!==((r==null?void 0:r.phone_number)||"")&&(j=await x(d.phone_number)),f&&j&&t(!1)}catch(n){console.error("Error saving profile:",n)}},y=()=>{h({full_name:(a==null?void 0:a.full_name)||"",username:(a==null?void 0:a.username)||"",phone_number:(r==null?void 0:r.phone_number)||""}),t(!1)};if(c)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(U,{})});const S=a!=null&&a.full_name?a.full_name.split(" ").map(n=>n[0]).join("").toUpperCase():((u=s.email)==null?void 0:u.charAt(0).toUpperCase())||"U";return e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Profile"}),e.jsx("p",{className:"text-gray-600",children:"Manage your account information and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(_,{className:"lg:col-span-1",children:[e.jsxs(w,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsxs(X,{className:"w-24 h-24",children:[e.jsx(Q,{src:(a==null?void 0:a.avatar_url)||"",alt:"Profile picture"}),e.jsx(Z,{className:"text-2xl font-bold bg-blue-100 text-blue-600",children:S})]})}),e.jsx(E,{className:"text-xl",children:(a==null?void 0:a.full_name)||"No name set"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(D,{variant:(r==null?void 0:r.role)==="admin"?"default":"secondary",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),(r==null?void 0:r.role)||"User"]})})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"truncate",children:s.email})]}),(r==null?void 0:r.phone_number)&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:r.phone_number})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(le,{className:"w-4 h-4"}),e.jsxs("span",{children:["Joined ",new Date((a==null?void 0:a.created_at)||"").toLocaleDateString()]})]})]})})]}),e.jsxs(_,{className:"lg:col-span-2",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),"Personal Information"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Update your personal details and contact information"})]}),e.jsx(N,{variant:o?"ghost":"outline",size:"sm",onClick:()=>o?y():t(!0),disabled:i,children:o?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Edit"]})})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"full_name",children:"Full Name"}),o?e.jsx(L,{id:"full_name",value:d.full_name,onChange:n=>h(f=>({...f,full_name:n.target.value})),placeholder:"Enter your full name"}):e.jsx("div",{className:"min-h-10 px-3 py-2 border rounded-md bg-gray-50 flex items-center",children:(a==null?void 0:a.full_name)||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"username",children:"Username"}),o?e.jsx(L,{id:"username",value:d.username,onChange:n=>h(f=>({...f,username:n.target.value})),placeholder:"Enter username"}):e.jsx("div",{className:"min-h-10 px-3 py-2 border rounded-md bg-gray-50 flex items-center",children:(a==null?void 0:a.username)||"Not set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"Email Address"}),e.jsxs("div",{className:"min-h-10 px-3 py-2 border rounded-md bg-gray-100 flex items-center text-gray-600",children:[s.email,e.jsx("span",{className:"ml-2 text-xs",children:"(Cannot be changed)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"phone_number",children:"Phone Number"}),o?e.jsx(L,{id:"phone_number",value:d.phone_number,onChange:n=>h(f=>({...f,phone_number:n.target.value})),placeholder:"+91 9876543210"}):e.jsx("div",{className:"min-h-10 px-3 py-2 border rounded-md bg-gray-50 flex items-center",children:(r==null?void 0:r.phone_number)||"Not set"})]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(N,{variant:"outline",onClick:y,disabled:i,children:"Cancel"}),e.jsx(N,{onClick:p,disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Save Changes"]})})]})]})]})]})]}),e.jsxs(_,{className:"mt-6",children:[e.jsxs(w,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Account Security"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your account security and authentication settings"})]}),e.jsx(C,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Password"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Last updated: ",new Date().toLocaleDateString()]})]}),e.jsx(N,{variant:"outline",size:"sm",children:"Change Password"})]}),e.jsxs("div",{className:"flex justify-between items-center p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Account Role"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your current access level"})]}),e.jsx(D,{variant:(r==null?void 0:r.role)==="admin"?"default":"secondary",children:(r==null?void 0:r.role)||"User"})]})]})})]})]})})};export{De as default};
