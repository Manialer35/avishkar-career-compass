import{aC as b,u as v,r as d,s as j,j as e,b as m,L as f,A as y,h as x,m as u,aA as M,az as C}from"./index-DuRND2GT.js";import{C as E}from"./circle-check-big-BgoBNM54.js";import{E as A}from"./eye-N4MU9IuM.js";import{T as L}from"./triangle-alert-cQ5blOLB.js";const k=({productId:a,purchaseSuccess:t=!1,productName:l=""})=>{var h;const c=b(),{toast:r}=v(),[s,p]=d.useState(null),[N,o]=d.useState(!0);d.useEffect(()=>{a?g():o(!1),t&&r({title:"Purchase Successful!",description:`You now have access to "${l}"`,duration:5e3})},[a,t]);const g=async()=>{try{o(!0);const{data:n,error:i}=await j.from("study_materials").select("*").eq("id",a).single();if(i)throw i;p(n)}catch(n){console.error("Error fetching material details:",n),r({title:"Error",description:"We couldn't load the material details.",variant:"destructive"})}finally{o(!1)}},w=()=>{if(s!=null&&s.ispremium)c(`/secure-material/${a}`);else{if(!(s!=null&&s.downloadurl)){r({title:"Download Error",description:"Download URL not available.",variant:"destructive"});return}window.open(s.downloadurl,"_blank"),a&&j.rpc("increment_material_downloads",{material_id:a}).then(({data:n,error:i})=>{i&&console.error("Error recording download:",i)})}};return N?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-pulse text-gray-500",children:"Loading material access..."})})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(m,{variant:"ghost",size:"icon",className:"mr-4",asChild:!0,children:e.jsx(f,{to:"/premium-materials",children:e.jsx(y,{className:"h-6 w-6"})})}),e.jsx("h1",{className:"text-2xl font-bold text-academy-primary",children:"Material Access"})]}),t?e.jsx(x,{className:"mb-8 bg-green-50 border-green-200",children:e.jsxs(u,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(E,{className:"text-green-500 h-6 w-6"}),e.jsx("h2",{className:"text-xl font-semibold text-green-700",children:"Purchase Successful!"})]}),e.jsxs("p",{className:"text-green-700",children:['Thank you for your purchase. You now have access to "',l||(s==null?void 0:s.title),'".']})]})}):null,s?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:s.title}),e.jsx("p",{className:"text-gray-600 mb-6",children:s.description}),e.jsxs(m,{onClick:w,className:"w-full sm:w-auto flex items-center gap-2",children:[e.jsx(A,{size:18}),s.ispremium?"View Material Securely":"Download Material"]}),s.ispremium&&e.jsx("p",{className:"text-xs text-orange-600 mt-2",children:"Premium materials can only be viewed within the app for security."})]})})}),e.jsx("div",{children:e.jsx(x,{children:e.jsxs(u,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Material Information"}),s.thumbnailurl&&e.jsx("div",{className:"mb-4",children:e.jsx("img",{src:s.thumbnailurl,alt:s.title,className:"w-full h-auto rounded-md"})}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Type:"}),e.jsx("span",{children:s.ispremium?"Premium (Secure)":"Free"})]}),s.ispremium&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Price:"}),e.jsxs("span",{children:["$",(h=s.price)==null?void 0:h.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Downloads:"}),e.jsx("span",{children:s.download_count||0})]})]})]})})})]}):e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(L,{className:"h-12 w-12 text-red-500"})}),e.jsx("h2",{className:"text-red-600 text-lg font-medium mb-2",children:"Material Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"We couldn't find the material you're looking for."}),e.jsx(m,{asChild:!0,children:e.jsx(f,{to:"/premium-materials",children:"Browse Materials"})})]})]})},T=()=>{var r,s;const{productId:a}=M(),t=C(),l=((r=t.state)==null?void 0:r.purchaseSuccess)||!1,c=((s=t.state)==null?void 0:s.productName)||"";return e.jsx(k,{productId:a,purchaseSuccess:l,productName:c})};export{T as default};
