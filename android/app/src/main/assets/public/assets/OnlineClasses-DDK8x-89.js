const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./GooglePayButton-TY62sDeP.js","./index-BXWU0Hg5.js","./index-DZLcdhNZ.css"])))=>i.map(i=>d[i]);
var U=Object.defineProperty;var K=(s,t,l)=>t in s?U(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l;var k=(s,t,l)=>K(s,typeof t!="symbol"?t+"":t,l);import{c as F,R as T,_ as Z,j as e,b as _,r as d,u as J,d as Q,D as W,e as X,f as I,g as ee,I as V,h as se,i as ae,k as te,l as re,m as le,s as w,S as u,C as ne,a as ie,U as ce}from"./index-BXWU0Hg5.js";import{B as oe}from"./badge-CSPOiEDB.js";import{u as de}from"./use-mobile-CkMmb_0E.js";import{T as me}from"./textarea-DKTdZ49W.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=F("Bookmark",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),xe=({productId:s,productName:t,price:l,onSuccess:x,onCancel:i})=>{const o=T.lazy(()=>Z(()=>import("./GooglePayButton-TY62sDeP.js"),__vite__mapDeps([0,1,2]),import.meta.url));return e.jsx(T.Suspense,{fallback:e.jsx(_,{disabled:!0,className:"w-full bg-gray-800 hover:bg-gray-700 flex items-center justify-center gap-2 py-3",children:e.jsx("span",{children:"Loading Payment..."})}),children:e.jsx(o,{productId:s,productName:t,price:l,onSuccess:x,onCancel:i})})},pe=s=>{const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s?s.length>254?{isValid:!1,error:"Email is too long"}:t.test(s)?{isValid:!0}:{isValid:!1,error:"Please enter a valid email address"}:{isValid:!1,error:"Email is required"}},fe=s=>{const t=/^[+]?[0-9\s\-\(\)]{10,15}$/;return s?t.test(s)?{isValid:!0}:{isValid:!1,error:"Please enter a valid phone number"}:{isValid:!1,error:"Phone number is required"}},ge=s=>!s||s.trim().length===0?{isValid:!1,error:"Name is required"}:s.length<2?{isValid:!1,error:"Name must be at least 2 characters long"}:s.length>100?{isValid:!1,error:"Name is too long"}:/^[a-zA-Z\s\-']+$/.test(s)?{isValid:!0}:{isValid:!1,error:"Name can only contain letters, spaces, hyphens, and apostrophes"},f=s=>s.replace(/[<>'"&]/g,"").trim().substring(0,1e3);class ye{constructor(t=5,l=6e4){k(this,"attempts",new Map);k(this,"maxAttempts");k(this,"windowMs");this.maxAttempts=t,this.windowMs=l}isAllowed(t){const l=Date.now(),i=(this.attempts.get(t)||[]).filter(o=>l-o<this.windowMs);return i.length>=this.maxAttempts?!1:(i.push(l),this.attempts.set(t,i),!0)}}const je=new ye(3,3e5),be=({open:s,onClose:t,classTitle:l,classDate:x,classId:i,classAmount:o})=>{const[g,y]=d.useState(""),[p,E]=d.useState(""),[j,a]=d.useState(""),[h,C]=d.useState(""),[c,D]=d.useState(!1),[R,S]=d.useState(!1),[m,L]=d.useState({}),{toast:b}=J(),{user:N}=Q(),M=()=>{const r={},n=ge(g);n.isValid||(r.name=n.error);const v=pe(p);v.isValid||(r.email=v.error);const P=fe(j);return P.isValid||(r.phone=P.error),N&&N.email!==p&&(r.email="Email must match your account email"),L(r),Object.keys(r).length===0},O=async r=>{r.preventDefault();const n=(N==null?void 0:N.uid)||p;if(!je.isAllowed(n)){b({title:"Too Many Attempts",description:"Please wait before trying again",variant:"destructive"});return}if(!M()){b({title:"Validation Error",description:"Please fix the errors in the form",variant:"destructive"});return}o>0?S(!0):await q()},q=async r=>{try{D(!0);const n={student_name:f(g),student_email:f(p),student_phone:f(j),student_address:f(h),class_title:f(l),class_date:x,class_id:f(i),amount_paid:o,payment_status:r?"completed":"waived",payment_id:r,payment_method:r?"razorpay":"free"},{data:v,error:P}=await w.from("classes").select("id, class_price, is_active").eq("id",i).single();if(P||!v)throw new Error("Class not found or inactive");if(Math.abs(o-v.class_price)>.01)throw new Error("Price mismatch detected");const{data:H,error:A}=await w.from("class_enrollments").select("id").eq("student_email",n.student_email).eq("class_id",i).maybeSingle();if(A&&console.error("Error checking duplicate enrollment:",A),H)throw new Error("You are already enrolled in this class");const{error:B}=await w.from("class_enrollments").insert(n);if(B)throw B;const{error:z}=await w.from("class_registrations").insert({student_name:n.student_name,student_email:n.student_email,student_phone:n.student_phone,student_address:n.student_address,class_title:n.class_title,class_date:n.class_date,class_id:n.class_id});if(z)throw z;b({title:"Success!",description:`You have successfully enrolled in ${l}`}),t(),y(""),E(""),a(""),C(""),L({})}catch(n){console.error("Error submitting enrollment:",n),b({title:"Error",description:n.message,variant:"destructive"})}finally{D(!1)}},$=()=>{S(!1)},G=()=>{q(`razorpay-${Date.now()}`)},Y=()=>{S(!1),b({title:"Payment Cancelled",description:"You cancelled the payment process.",variant:"default"})};return e.jsx(W,{open:s,onOpenChange:t,children:e.jsxs(X,{className:"max-w-md",children:[e.jsx(I,{children:e.jsx(ee,{className:"text-xl font-semibold",children:R?`Payment for ${l}`:`Enroll in ${l}`})}),R?e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs(se,{className:"mb-4",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Payment Details"}),e.jsxs(re,{children:["Amount: ₹",o.toFixed(2)]})]}),e.jsxs(le,{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Please complete your payment using Google Pay to enroll in this class."}),e.jsx(xe,{productId:i,productName:l,price:o,onSuccess:G,onCancel:Y})]})]}),e.jsx("div",{className:"pt-2 flex justify-between",children:e.jsx(_,{type:"button",variant:"outline",onClick:$,children:"Back"})})]}):e.jsxs("form",{onSubmit:O,className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Name *"}),e.jsx(V,{id:"name",value:g,onChange:r=>y(r.target.value),placeholder:"Enter your full name",required:!0,className:m.name?"border-red-500":""}),m.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsx(V,{id:"email",type:"email",value:p,onChange:r=>E(r.target.value),placeholder:"Enter your email",required:!0,className:m.email?"border-red-500":""}),m.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number *"}),e.jsx(V,{id:"phone",value:j,onChange:r=>a(r.target.value),placeholder:"Enter your phone number",required:!0,className:m.phone?"border-red-500":""}),m.phone&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.phone})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),e.jsx(me,{id:"address",value:h,onChange:r=>C(r.target.value),placeholder:"Enter your address",rows:2,maxLength:500})]}),e.jsxs("div",{className:"pt-2 flex justify-between",children:[e.jsx(_,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),e.jsx(_,{type:"submit",disabled:c,children:c?"Processing...":o>0?"Proceed to Payment":"Enroll Now"})]})]})]})})},Ce=()=>{const[s,t]=d.useState([]),[l,x]=d.useState(!0),[i,o]=d.useState(null),[g,y]=d.useState(!1);de(),d.useEffect(()=>{p()},[]);const p=async()=>{try{x(!0),console.log("Fetching classes data...");const{data:a,error:h}=await w.from("classes").select("*").eq("is_active",!0).order("class_date",{ascending:!0});if(h)throw console.error("Error fetching classes:",h),h;if(a){console.log("Classes data fetched:",a.length);const C=a.map(c=>({id:c.id,title:c.class_title,description:c.class_description||"",date:new Date(c.class_date).toLocaleDateString(),time:c.class_time,duration:c.class_duration,instructor:c.class_instructor,level:c.class_level,category:c.class_category,price:Number(c.class_price)||0,capacity:c.class_capacity}));t(C)}}catch(a){console.error("Error in fetchClasses:",a)}finally{x(!1)}},E=a=>{o(a),y(!0)},j=a=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden border border-gray-100 flex flex-col",children:[e.jsxs("div",{className:"p-5 flex-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:"font-bold text-lg text-academy-primary",children:a.title}),e.jsx(oe,{variant:"outline",className:"bg-academy-secondary/10 text-academy-secondary",children:a.category})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:a.description}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:a.date})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[a.time," (",a.duration,")"]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:a.instructor})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),e.jsxs("span",{children:[a.level," Level"]})]})]})]}),e.jsx("div",{className:"p-5 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-lg font-bold text-academy-primary",children:["₹",a.price]}),a.capacity&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(",a.capacity," seats available)"]})]}),e.jsxs(_,{className:"whitespace-nowrap",variant:"default",size:"sm",onClick:()=>E(a),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Enroll Now"]})]})})]},a.id);return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-center mb-8 text-academy-primary",children:"Online Classes & Training Programs"}),l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((a,h)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{className:"h-6 w-1/2 mb-4"}),e.jsx(u,{className:"h-6 w-1/4 rounded-full"})]}),e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-2/3 mb-4"}),e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-4 w-full mb-2"}),e.jsx(u,{className:"h-10 w-full mt-4"})]},h))}):s.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No online classes currently available."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(a=>j(a))}),i&&e.jsx(be,{open:g,onClose:()=>y(!1),classTitle:i.title,classDate:i.date,classId:i.id,classAmount:i.price})]})};export{Ce as default};
